tigress <-
  function(expdata, tflist=colnames(expdata), targetlist=colnames(expdata), alpha=0.2, nstepsLARS=5, nsplit=100, normalizeexp=TRUE, scoring="area", allsteps=TRUE, verb=FALSE, usemulticore=FALSE)
  {
    # Check if we can run multicore
    if (usemulticore) {
      require(parallel)
    }
    
    # Gene names
    genenames <- colnames(expdata)
    ngenes <- length(genenames)
      
    # Normalize expression data for each gene
    if (normalizeexp)
      expdata <- scale(expdata)
    
    # Make sure there are no more steps than variables
    if (nstepsLARS>length(tflist)-1){
      nstepsLARS<-length(tflist)-1
      if (nstepsLARS==0){cat('Too few transcription factors! \n',stderr())}
      if (verb){
        cat(paste('Variable nstepsLARS was changed to: ',nstepsLARS,'\n')) }}
    
    # Locate TF in gene list by matching their names
    ntf <- length(tflist)
    tfindices <- match(tflist,genenames)
    if (max(is.na(tfindices))) {
      stop('Error: could not find all TF in the gene list!')
    }
    
    # Locate targets in gene list by matching their names
    ntargets <- length(targetlist)
    targetindices <- match(targetlist,genenames)
    if (max(is.na(targetindices))) {
      stop('Error: could not find all targets in the gene list!')
    }
    print("A")
    # Prepare scoring matrix
    if (allsteps) {
      scorestokeep <- nstepsLARS
    } else {
      scorestokeep <- 1
    }
    score <- list()
    
    # A small function to score the regulators of a single gene
    stabselonegene <- function(itarget) {
      print(itarget)
      if (verb) {
        cat('.')
      }
      
      # Name of the target gene
      targetname <- targetlist[itarget]
      # Find the TF to be used for prediction (all TF except the target if the target is itself a TF)
      predTF <- !match(tflist,targetname,nomatch=0)
      r <- stabilityselection(as.matrix(expdata[,tfindices[predTF]]), as.matrix(expdata[,targetname]), nsplit=nsplit, nsteps=nstepsLARS, alpha=alpha)
      sc <- array(0,dim=c(ntf,scorestokeep),dimnames = list(tflist,seq(scorestokeep)))
      if (allsteps) {
        sc[predTF,] <- t(r)
      } else {
        sc[predTF,] <- t(r[nstepsLARS,])
      }
      invisible(sc)
    }
    
    # Treat target genes one by one
    if (usemulticore) {
      if (requireNamespace("foreach") && foreach::getDoParRegistered()) {
        `%dopar%` = foreach::`%dopar%`
        score <- foreach::foreach(i=seq(ntargets), .packages=c("tigress", "lars"),
                                  .export=c("targetlist", "tflist", "tfindices", "expdata",
                                            "verb", "nsplit", "nstepsLARS", "alpha", "ntf",
                                            "scorestokeep", "allsteps")) %dopar% stabselonegene(i)
      } else {
        score <- mclapply(seq(ntargets),stabselonegene,mc.cores=detectCores()-1)
      }
    } else {
      score <- lapply(seq(ntargets),stabselonegene)
    }
    print("B")
    # Rank scores
    edgepred <- list()
    for (i in seq(scorestokeep)) {
      # Combine all scores in a single vectors
      edgepred[[i]] <- matrix(unlist(lapply(score,function(x) x[,i,drop=FALSE])), nrow=ntf)
      rownames(edgepred[[i]]) <- tflist
      colnames(edgepred[[i]]) <- targetlist
    }
    
    # Return the result
    if (allsteps) {
      return(edgepred)
    } else {
      return(edgepred[[1]])
    }
  }

stabilityselection <-
  function(x,y,nsplit=100,nstepsLARS=20,alpha=0.2,scoring="area")
  {
    if (!is.numeric(y) || sd(y)==0) stop("y should be a vector of scalars not constant.")
    n <- nrow(x)
    p <- ncol(x)
    halfsize <- as.integer(n/2)
    freq <- matrix(0,nstepsLARS,p)
    
    i <- 0
    while (i < 2*nsplit) {
      # Randomly reweight each variable
      xs <- t(t(x)*runif(p,alpha,1))
      
      # Ramdomly split the sample in two sets
      badsplit <- TRUE
      while (badsplit) {
        perm <- sample(n)
        i1 <- perm[1:halfsize]
        i2 <- perm[(halfsize+1):n]
        if (max(sd(y[i1]),sd(y[i2]))>0) {badsplit=FALSE}
      }
      
      # run LARS on each randomized, sample and check which variables are selected
      if (sd(y[i1]>0)) {
        r <- lars(xs[i1,],y[i1],max.steps=nstepsLARS,normalize=FALSE,trace=FALSE)
        freq<-freq + abs(sign(r$beta[2:(nstepsLARS+1),]))
        i <- i+1
      }
      if (sd(y[i2]>0)) {
        r <- lars(xs[i2,],y[i2],max.steps=nstepsLARS,normalize=FALSE,trace=FALSE)
        freq<-freq + abs(sign(r$beta[2:(nstepsLARS+1),]))
        i <- i+1
      }
    }
    
    # normalize frequence in [0,1] to get the stability curves
    freq <- freq/i
    
    # Compute normalized area under the stability curve
    if (scoring=="area")
      score <- apply(freq,2,cumsum)/seq(nstepsLARS)
    else
      score <- apply(freq, 2, cummax)
    
    invisible(score)
  }

setwd("/home/soel/giraffe/notebooks/data/kidney/")
expr <- read.csv("expr_t.csv")
rownames(expr)=expr[,1]

# Obtained in Python through
# tf = []
#for t in expression.index:
#  if t in R_0.columns:
#  tf.append(t)

#for t in tf:
#print("\"" + t + "\", ")

tf <- c("NFYA", 
        "ARX", 
        "HOXA11", 
        "MEOX1", 
        "SOX8", 
        "ZFX", 
        "YBX2", 
        "ZNF263", 
        "DLX6", 
        "ETV1", 
        "PAX6", 
        "TEAD3", 
        "E2F2", 
        "TFAP2B", 
        "TFAP2D", 
        "NFIX", 
        "PAX7", 
        "MLXIPL", 
        "ETV7", 
        "ZNF200", 
        "HIVEP2", 
        "DPF1", 
        "ZBTB32", 
        "NR1H4", 
        "ISL1", 
        "ZNF582", 
        "SNAI2", 
        "ZFP64", 
        "RUNX3", 
        "HSF2", 
        "NR1H3", 
        "POU2F2", 
        "ARNTL2", 
        "IKZF2", 
        "HOXC8", 
        "SOX30", 
        "BARX2", 
        "ZIC2", 
        "FOXP3", 
        "NFE2L3", 
        "ALX4", 
        "FOXN3", 
        "FOXC1", 
        "PRDM1", 
        "MXD1", 
        "YBX3", 
        "PRDM6", 
        "AHRR", 
        "GSC2", 
        "DLX3", 
        "DMRT3", 
        "POU1F1", 
        "HMG20B", 
        "ZNF76", 
        "FOXJ2", 
        "YBX1", 
        "NFYC", 
        "SPI1", 
        "KLF6", 
        "MEF2A", 
        "TFE3", 
        "PITX1", 
        "RORA", 
        "HES2", 
        "MNT", 
        "TCF3", 
        "SREBF1", 
        "NFATC3", 
        "TP63", 
        "TBX21", 
        "GLI2", 
        "TEAD2", 
        "ZNF37A", 
        "FOSL2", 
        "PAX2", 
        "RARB", 
        "NFKB2", 
        "HOXA9", 
        "TP73", 
        "CIC", 
        "RFX3", 
        "TCF7", 
        "MEF2C", 
        "ZNF506", 
        "PGR", 
        "NFE2L1", 
        "GRHL2", 
        "ZNF324", 
        "ZNF671", 
        "ZNF416", 
        "ZNF586", 
        "ZNF264", 
        "REST", 
        "MYNN", 
        "MECOM", 
        "ZNF213", 
        "TFAP2C", 
        "RFX2", 
        "ZNF343", 
        "EBF4", 
        "KDM2B", 
        "LHX5", 
        "TBX5", 
        "ZNF302", 
        "TFAP4", 
        "POU4F3", 
        "ZFHX4", 
        "ESR1", 
        "CEBPE", 
        "TBX15", 
        "CREM", 
        "HIVEP1", 
        "CDC5L", 
        "ZNF184", 
        "MZF1", 
        "PATZ1", 
        "SOX10", 
        "XBP1", 
        "SIX4", 
        "HIF1A", 
        "YY1", 
        "NFATC4", 
        "VSX1", 
        "MYBL2", 
        "HNF4A", 
        "NFATC2", 
        "TCFL5", 
        "GMEB2", 
        "E2F1", 
        "RHOXF1", 
        "ELF4", 
        "GATA1", 
        "KLF8", 
        "KLF5", 
        "HSF4", 
        "NFAT5", 
        "ZNF423", 
        "CTCF", 
        "ZNF821", 
        "FOXF1", 
        "ZNF174", 
        "MAZ", 
        "RELB", 
        "LYL1", 
        "ZNF419", 
        "CRX", 
        "MEIS3", 
        "ZNF175", 
        "DBP", 
        "KLF1", 
        "ETV2", 
        "USF2", 
        "PBX4", 
        "ERF", 
        "ZNF574", 
        "ZNF85", 
        "HBP1", 
        "SP4", 
        "DLX5", 
        "TFEC", 
        "HOXA1", 
        "HOXA2", 
        "HOXA3", 
        "HOXA5", 
        "HOXA6", 
        "HOXA13", 
        "EVX1", 
        "ZKSCAN1", 
        "PAX4", 
        "NOBOX", 
        "NRF1", 
        "MEOX2", 
        "POU6F2", 
        "AHR", 
        "GLI3", 
        "LHX2", 
        "LHX6", 
        "CREB3", 
        "LHX3", 
        "GLIS3", 
        "GATA3", 
        "TLX1", 
        "PITX3", 
        "EBF3", 
        "HOXB6", 
        "MLX", 
        "DLX4", 
        "HLF", 
        "FOXN1", 
        "PHOX2B", 
        "NFKB1", 
        "ELF2", 
        "NKX3-2", 
        "KLF3", 
        "DBX1", 
        "SOX6", 
        "PRDM4", 
        "MYF6", 
        "MYF5", 
        "GLI1", 
        "ELK3", 
        "FOXM1", 
        "CUX2", 
        "CREBL2", 
        "VDR", 
        "NANOG", 
        "RFX4", 
        "PPARD", 
        "BACH2", 
        "E2F3", 
        "SIM1", 
        "NR2E1", 
        "TFEB", 
        "TBP", 
        "SRF", 
        "TBX18", 
        "HAND1", 
        "IRX4", 
        "NR3C1", 
        "SMAD5", 
        "CDX1", 
        "BCL6", 
        "HES1", 
        "BBX", 
        "FOXP1", 
        "TFCP2L1", 
        "TLX2", 
        "STAT1", 
        "OTX1", 
        "CEBPZ", 
        "DLX2", 
        "ATF2", 
        "EPAS1", 
        "ARID3A", 
        "VAX2", 
        "NFE2L2", 
        "PRRX1", 
        "MEF2D", 
        "TFAP2E", 
        "NR5A2", 
        "MYCL", 
        "ZNF684", 
        "ETV3", 
        "IRF6", 
        "PROX1", 
        "KMT2A", 
        "ATF6", 
        "CREB1", 
        "KLF7", 
        "PLAGL1", 
        "MYB", 
        "TCF21", 
        "ZNF430", 
        "FOXO3", 
        "TGIF2", 
        "KLF12", 
        "KLF9", 
        "NR4A3", 
        "ONECUT2", 
        "ZBTB45", 
        "PROX2", 
        "VSX2", 
        "ESRRB", 
        "ZNF410", 
        "BCL11A", 
        "NKX2-3", 
        "MXI1", 
        "HOXB8", 
        "HOXB5", 
        "HOXB3", 
        "HOXB1", 
        "MSX2", 
        "SOHLH2", 
        "ELF1", 
        "SMAD9", 
        "EGR1", 
        "ZFP30", 
        "NR2C1", 
        "NFYB", 
        "TBX2", 
        "TBX4", 
        "ZNF549", 
        "ZNF211", 
        "LHX4", 
        "GTF3A", 
        "TBX22", 
        "MYOG", 
        "ZNF205", 
        "HOXA7", 
        "TWIST1", 
        "NEUROG3", 
        "EGR2", 
        "BHLHE41", 
        "ATF1", 
        "NEUROD4", 
        "NR4A1", 
        "HOXC13", 
        "HOXC11", 
        "NFE2", 
        "HOXC12", 
        "IKZF4", 
        "ESX1", 
        "BATF3", 
        "MXD4", 
        "CTCFL", 
        "SNAI1", 
        "RBPJL", 
        "HIF3A", 
        "ZNF45", 
        "SPDEF", 
        "SOX4", 
        "RREB1", 
        "RUNX2", 
        "GCM2", 
        "MYRF", 
        "SOX21", 
        "IRF1", 
        "SOX9", 
        "BARHL1", 
        "BHLHE23", 
        "PAX8", 
        "FOSB", 
        "FOXA2", 
        "PAX1", 
        "NKX2-4", 
        "CENPB", 
        "NKX2-2", 
        "ZNF133", 
        "OVOL2", 
        "TCF15", 
        "ZNF436", 
        "MAX", 
        "THRA", 
        "NR1D1", 
        "IRF3", 
        "STAT5A", 
        "GLIS2", 
        "ZNF384", 
        "ELK1", 
        "SIX1", 
        "ZBTB1", 
        "ZNF484", 
        "HIVEP3", 
        "BCL11B", 
        "KLF2", 
        "ATF4", 
        "FOXP2", 
        "IRF5", 
        "FEZF1", 
        "HOXD1", 
        "HOXD3", 
        "HOXD9", 
        "HOXD10", 
        "HOXD11", 
        "HOXD13", 
        "MYOD1", 
        "E2F8", 
        "SOX15", 
        "FOXA1", 
        "NRL", 
        "FOXJ1", 
        "KLF16", 
        "ZSCAN10", 
        "JUND", 
        "ZNF557", 
        "MNX1", 
        "ZNF337", 
        "GATA5", 
        "NPAS1", 
        "ZNF317", 
        "DNMT1", 
        "ZNF331", 
        "ZNF341", 
        "ZNF141", 
        "NFATC1", 
        "CDX4", 
        "NR1H2", 
        "BARX1", 
        "RHOXF2", 
        "RARA", 
        "ZNF304", 
        "ZSCAN5A", 
        "ZNF132", 
        "LIN28A", 
        "THAP1", 
        "PPARG", 
        "TERF2", 
        "E2F5", 
        "ARNTL", 
        "GSC", 
        "MBD2", 
        "BHLHE40", 
        "MEIS2", 
        "GRHL1", 
        "MYCN", 
        "RAX", 
        "SOX5", 
        "SOX3", 
        "CLOCK", 
        "ETS1", 
        "HNF1A", 
        "TBX3", 
        "EHF", 
        "ELF5", 
        "TFCP2", 
        "HEY2", 
        "EGR4", 
        "EMX1", 
        "PAX3", 
        "NKX2-8", 
        "NKX2-1", 
        "ZFHX2", 
        "TBR1", 
        "GATA4", 
        "HLX", 
        "KLF4", 
        "ZNF189", 
        "NR5A1", 
        "XPA", 
        "LMX1B", 
        "MYC", 
        "DMRT1", 
        "FOXP4", 
        "ZSCAN9", 
        "TFAP2A", 
        "IRF4", 
        "GCM1", 
        "FOXF2", 
        "HMGA1", 
        "CREBZF", 
        "POU2F3", 
        "SIX3", 
        "LBX1", 
        "TET1", 
        "STAT4", 
        "LEF1", 
        "ETV6", 
        "ASCL1", 
        "FOXN4", 
        "PDX1", 
        "ZNF740", 
        "MBNL2", 
        "ZIC5", 
        "ESR2", 
        "JDP2", 
        "TCF12", 
        "ZSCAN29", 
        "ZFHX3", 
        "IRF8", 
        "ZNF287", 
        "GATA6", 
        "TP53", 
        "FOXK2", 
        "SMAD4", 
        "NFIC", 
        "ZIM3", 
        "DMRTC2", 
        "ZFP14", 
        "ZNF787", 
        "ZNF614", 
        "PRDM16", 
        "DMRTA2", 
        "BARHL2", 
        "RXRG", 
        "TBX19", 
        "POU2F1", 
        "NR1I3", 
        "LHX9", 
        "RORC", 
        "RFX5", 
        "ARNT", 
        "CREB3L4", 
        "SOX13", 
        "OSR1", 
        "MEIS1", 
        "DLX1", 
        "HES6", 
        "ZNF660", 
        "NR1I2", 
        "ZNF300", 
        "RBAK", 
        "CREB5", 
        "FERD3L", 
        "ZNF157", 
        "ZNF182", 
        "ZNF41", 
        "ZNF711", 
        "HMBOX1", 
        "ST18", 
        "PRDM14", 
        "ZNF7", 
        "NFIB", 
        "NR6A1", 
        "ZEB1", 
        "VAX1", 
        "TCF7L2", 
        "NKX6-2", 
        "ZNF214", 
        "TBX6", 
        "HMGA2", 
        "ARID5B", 
        "FOXO1", 
        "THRB", 
        "NPAS3", 
        "MSGN1", 
        "POU4F2", 
        "NR3C2", 
        "VENTX", 
        "FLI1", 
        "ZNF385D", 
        "POU4F1", 
        "TCF7L1", 
        "ZNF547", 
        "ZNF776", 
        "ZSCAN1", 
        "HHEX", 
        "ZIC1", 
        "NR4A2", 
        "FEZF2", 
        "UBP1", 
        "TGIF2LX", 
        "CEBPG", 
        "GABPA", 
        "CXXC1", 
        "ZNF18", 
        "KLF10", 
        "ZKSCAN2", 
        "BATF", 
        "ALX3", 
        "BACH1", 
        "ZIC3", 
        "ZNF19", 
        "ERG", 
        "ETS2", 
        "CREB3L1", 
        "ELK4", 
        "USF1", 
        "ZNF276", 
        "HOXB13", 
        "RUNX1", 
        "SIM2", 
        "IRX6", 
        "ISL2", 
        "ZNF222", 
        "ZNF235", 
        "NR2F6", 
        "PKNOX1", 
        "AIRE", 
        "ZNF714", 
        "ZBTB7B", 
        "ZNF394", 
        "ZNF333", 
        "FOXH1", 
        "ZNF382", 
        "IKZF3", 
        "ZNF653", 
        "BCL6B", 
        "ZNF75A", 
        "TAL1", 
        "GMEB1", 
        "NFIA", 
        "LHX8", 
        "GFI1", 
        "ZNF281", 
        "ZNF496", 
        "LMX1A", 
        "ATF3", 
        "REL", 
        "NEUROD1", 
        "EN1", 
        "MSX1", 
        "ELF3", 
        "FEV", 
        "EOMES", 
        "NKX6-1", 
        "HESX1", 
        "TCF23", 
        "ZNF513", 
        "ZNF148", 
        "KLF15", 
        "HEYL", 
        "ZNF691", 
        "ZNF589", 
        "PITX2", 
        "HAND2", 
        "PRDM9", 
        "SPZ1", 
        "EBF1", 
        "FOXQ1", 
        "TLX3", 
        "TBX20", 
        "NEUROD6", 
        "ZNF12", 
        "SP8", 
        "HEY1", 
        "ZNF704", 
        "SOX17", 
        "HNF4G", 
        "EN2", 
        "UNCX", 
        "GBX1", 
        "FOXK1", 
        "OSR2", 
        "NFIL3", 
        "NKX6-3", 
        "ZHX1", 
        "HDX", 
        "PHOX2A", 
        "PKNOX2", 
        "ZNF22", 
        "CDX2", 
        "OTX2", 
        "DRGX", 
        "GFI1B", 
        "ZNF219", 
        "E2F7", 
        "SPIC", 
        "ZNF202", 
        "ZNF143", 
        "ZNF3", 
        "MESP1", 
        "STAT6", 
        "SMAD3", 
        "NKX3-1", 
        "TEF", 
        "PBX3", 
        "PRRX2", 
        "SP2", 
        "ZNF180", 
        "ZNF641", 
        "ZNF610", 
        "ZNF528", 
        "ZNF701", 
        "ZNF146", 
        "ZNF283", 
        "ZNF444", 
        "ZNF558", 
        "TBX10", 
        "ZNF232", 
        "E4F1", 
        "ZNF597", 
        "RBPJ", 
        "PTF1A", 
        "FOXI1", 
        "IRF2", 
        "GBX2", 
        "STAT3", 
        "ZNF30", 
        "SHOX2", 
        "ZBTB49", 
        "ATOH8", 
        "SOX14", 
        "E2F6", 
        "MECP2", 
        "AR", 
        "ZNF354A", 
        "ATF5", 
        "ZBTB43", 
        "NR0B1", 
        "ZNF280A", 
        "ZEB2", 
        "HIC2", 
        "ZNF32", 
        "GSX1", 
        "ONECUT1", 
        "KLF13", 
        "ZNF764", 
        "ZNF768", 
        "ZNF35", 
        "ZNF778", 
        "FOXD4", 
        "HOXD4", 
        "HOXD12", 
        "ZNF212", 
        "ZNF282", 
        "FOS", 
        "SMAD1", 
        "EMX2", 
        "SP7", 
        "NPAS2", 
        "IRX1", 
        "IRX2", 
        "SIX2", 
        "STAT2", 
        "FOXA3", 
        "ZNF16", 
        "ATF7", 
        "ZNF296", 
        "HOXB9", 
        "FOXN2", 
        "ZNF415", 
        "SOX7", 
        "ZNF692", 
        "NAIF1", 
        "JUNB", 
        "ZNF439", 
        "ZNF440", 
        "ZNF524", 
        "ZBTB26", 
        "ZNF562", 
        "ZNF561", 
        "NEUROD2", 
        "OTP", 
        "ZNF584", 
        "ZNF274", 
        "BPTF", 
        "ZIK1", 
        "NHLH1", 
        "ZNF540", 
        "ZNF570", 
        "KLF17", 
        "FOXB1", 
        "ZNF554", 
        "KLF11", 
        "CEBPB", 
        "ATOH1", 
        "HINFP", 
        "ARNT2", 
        "ZNF596", 
        "HOXC5", 
        "OVOL1", 
        "RARG", 
        "SP3", 
        "ZNF621", 
        "RELA", 
        "ZNF680", 
        "ESRRA", 
        "DMRT2", 
        "ZNF483", 
        "ZNF449", 
        "INSM1", 
        "ZNF417", 
        "HES3", 
        "STAT5B", 
        "ZNF791", 
        "HOXB2", 
        "RAX2", 
        "MGA", 
        "EVX2", 
        "ZBTB4", 
        "GLIS1", 
        "ZNF266", 
        "NR1D2", 
        "ZIC4", 
        "DDIT3", 
        "ZNF519", 
        "PROP1", 
        "ISX", 
        "ZNF25", 
        "FOSL1", 
        "ZNF77", 
        "MLXIP", 
        "NR2F1", 
        "ZNF169", 
        "ETV4", 
        "HOXD8", 
        "ASCL3", 
        "ZNF613", 
        "HSF5", 
        "FOXG1", 
        "ZNF135", 
        "FOXR1", 
        "DMRTA1", 
        "FOXL1", 
        "FOXC2", 
        "IRX5", 
        "SOX11", 
        "SIX5", 
        "ZBTB34", 
        "HIC1", 
        "TGIF1", 
        "NR2C2", 
        "OLIG3", 
        "ZBTB33", 
        "IRX3", 
        "NHLH2", 
        "JUN", 
        "SOX12", 
        "ZNF620", 
        "ZNF619", 
        "ZNF354C", 
        "ZNF114", 
        "ZNF454", 
        "ZNF543", 
        "ZNF354B", 
        "ZNF223", 
        "NEUROG2", 
        "MAF", 
        "ZNF713", 
        "MSC", 
        "ZNF852", 
        "FOXE1", 
        "ZNF552", 
        "ZBTB7A", 
        "ZFP42", 
        "HES7", 
        "GATA2", 
        "ARID3B", 
        "EGR3", 
        "ZBTB18", 
        "LBX2", 
        "ZBTB42", 
        "FOXS1", 
        "ATOH7", 
        "ZNF154", 
        "ZNF784", 
        "ZNF771", 
        "NKX2-6", 
        "ZNF816", 
        "ALX1", 
        "ZNF571", 
        "ZSCAN4", 
        "BHLHA15", 
        "GSX2", 
        "ZNF594", 
        "ZFP3", 
        "HOXC9", 
        "HOXC10", 
        "BHLHE22", 
        "ZNF443", 
        "ZNF792", 
        "ZFP82", 
        "ZNF707", 
        "ZNF322", 
        "ZNF467", 
        "SOX2", 
        "ZBTB2", 
        "HKR1", 
        "PLAG1", 
        "ZBTB20", 
        "RFX7", 
        "ZNF329", 
        "ZNF101", 
        "NEUROG1", 
        "ZNF716", 
        "ZNF708", 
        "CREB3L2", 
        "ZSCAN22", 
        "TBPL2", 
        "HOXB4", 
        "MAFA", 
        "SOX1", 
        "ZNF662", 
        "ZNF320", 
        "NKX2-5", 
        "TFDP3", 
        "ZNF530", 
        "FIGLA", 
        "ASCL2", 
        "FOXL2", 
        "ZNF730", 
        "TBX1", 
        "OLIG1", 
        "POU6F1", 
        "SIX6", 
        "FOXO4", 
        "POU3F2", 
        "FOXD4L1", 
        "ZFP1", 
        "ZNF93", 
        "FOXD4L4", 
        "ZBTB7C", 
        "WT1", 
        "ZFP90", 
        "RFX6", 
        "MAFF", 
        "HSF1", 
        "PURA", 
        "MIXL1", 
        "ZNF479", 
        "ZNF445", 
        "ZNF74", 
        "ZBTB37", 
        "IRF7", 
        "NR2F2", 
        "SP1", 
        "DBX2", 
        "PBX1", 
        "POU3F1", 
        "SNAI3", 
        "ZBTB3", 
        "MYBL1", 
        "IKZF1", 
        "ZNF267", 
        "SHOX", 
        "ZNF566", 
        "ZNF529", 
        "ZNF284", 
        "TAL2", 
        "ARGFX", 
        "ZBTB6", 
        "ZNF749", 
        "ZNF17", 
        "ZNF555", 
        "RXRA", 
        "ZNF75D", 
        "ZNF501", 
        "ZNF197", 
        "MYT1L", 
        "ZNF396", 
        "FOXD2", 
        "FOXI2", 
        "FOXE3", 
        "ZSCAN30", 
        "PPARA", 
        "TEAD1", 
        "MITF", 
        "FOXD3", 
        "FOXD4L3", 
        "LIN28B", 
        "ZFP69B", 
        "ZFP69", 
        "HELT", 
        "ASCL4", 
        "ZSCAN23", 
        "ZNF490", 
        "MESP2", 
        "ZNF626", 
        "ZNF793", 
        "ZNF383", 
        "HES4", 
        "ZNF669", 
        "HMX3", 
        "ZNF177", 
        "SKOR1", 
        "ZNF548", 
        "MTF1", 
        "HMX2", 
        "ZNF563", 
        "BSX", 
        "ZNF567", 
        "SP6", 
        "ZNF573", 
        "ZNF527", 
        "ZNF33A", 
        "ZKSCAN3", 
        "FOXR2", 
        "LIN54", 
        "PAX5", 
        "ZNF250", 
        "ZNF79", 
        "ZNF681", 
        "ZNF766", 
        "LCOR", 
        "ZKSCAN7", 
        "ZNF565", 
        "ZNF34", 
        "ZNF140", 
        "ZNF774", 
        "ZNF765", 
        "ZNF124", 
        "ZNF777", 
        "ZNF605", 
        "ZNF799", 
        "ESRRG", 
        "ZNF782", 
        "ZNF846", 
        "TCF4", 
        "ZNF136", 
        "ZKSCAN5", 
        "ZNF502", 
        "ZNF33B", 
        "ZNF431", 
        "ZNF418", 
        "POU3F4", 
        "ZSCAN16", 
        "ARID5A", 
        "ZFP28", 
        "ZNF585A", 
        "ZNF429", 
        "ZNF100", 
        "ZNF398", 
        "ZNF441", 
        "ZSCAN26", 
        "MAFG", 
        "ZNF682", 
        "ZNF257", 
        "ZNF785", 
        "ZNF655", 
        "ZNF98", 
        "ZNF786", 
        "ZNF675", 
        "ZNF860", 
        "ZNF695", 
        "HOXA4", 
        "TOPORS", 
        "DMBX1", 
        "ZNF615", 
        "ZNF433", 
        "ZNF460", 
        "HOXC6", 
        "ZNF81", 
        "ZNF780A", 
        "ZNF181", 
        "ZNF44", 
        "ZNF790", 
        "TEAD4", 
        "HES5", 
        "ZNF677", 
        "ZNF823", 
        "ZNF311", 
        "ZNF71", 
        "ZNF121", 
        "ZNF273", 
        "ZNF84", 
        "ZNF667", 
        "ZBTB14", 
        "ZNF649", 
        "ZNF248", 
        "ZNF770", 
        "TFDP1", 
        "ZNF334", 
        "ZNF485", 
        "ZNF442", 
        "HOXC4", 
        "ZNF26", 
        "ZNF69", 
        "ZNF480", 
        "ZNF587", 
        "ZNF808", 
        "MAFK", 
        "ZNF28", 
        "ZNF627", 
        "ZNF789", 
        "ZNF534", 
        "PAX9", 
        "FOXJ3", 
        "SREBF2", 
        "POU3F3", 
        "ZFP2", 
        "RORB", 
        "ZNF525", 
        "SOX18", 
        "RHOXF2B", 
        "FOXO6", 
        "MAFB", 
        "RXRB", 
        "PBX2", 
        "SP5", 
        "ZBTB12", 
        "ZNF805", 
        "POU5F1", 
        "DPRX", 
        "ZNF468", 
        "ZNF616", 
        "FOXB2", 
        "ZFP57", 
        "FOXD4L5", 
        "ZBTB48", 
        "ZNF783", 
        "ZNF425", 
        "ARID3C", 
        "E2F4", 
        "DPF3", 
        "ONECUT3", 
        "OLIG2", 
        "POU5F1B", 
        "ZNF580", 
        "ZNF611", 
        "ZNF254", 
        "MXD3", 
        "ATF6B", 
        "ZNF134", 
        "IRF9", 
        "ZNF90", 
        "MEF2B", 
        "ZNF891", 
        "FOXI3", 
        "NOTO", 
        "CPEB1", 
        "ZBED1", 
        "HOMEZ", 
        "ZNF705G", 
        "SCRT2", 
        "SKOR2", 
        "HMX1", 
        "SP9", 
        "EBF2", 
        "CEBPD", 
        "ZNF880", 
        "ANHX", 
        "NKX1-2", 
        "ZNF492", 
        "YY2", 
        "ASCL5", 
        "TWIST2", 
        "ZNF879", 
        "ZNF736", 
        "ZSCAN31", 
        "NKX1-1", 
        "ZBTB22", 
        "ZNF737", 
        "ETV5", 
        "CEBPA", 
        "ZNF324B", 
        "ZNF564", 
        "GLI4", 
        "ZNF674", 
        "ZNF345", 
        "ZNF550", 
        "FOXD1", 
        "HOXA10", 
        "ETV3L", 
        "ZNF260", 
        "ZNF432", 
        "ZNF10", 
        "ZNF486", 
        "ZNF225", 
        "ZNF350", 
        "CUX1", 
        "DUXA", 
        "HOXB7", 
        "SCX", 
        "DUX4", 
        "SCRT1", 
        "TCF24", 
        "KLF14", 
        "ZNF285", 
        "ZNF224", 
        "SPIB", 
        "ZIM2", 
        "ZNF595", 
        "FOXD4L6", 
        "LHX1", 
        "SEBOX", 
        "ZNF2", 
        "HNF1B", 
        "ZNF8", 
        "NR2E3")
library(lars)
start = 2
while(start < dim(expr)[2]){
  start_time <- Sys.time()
  end = min(start + 5000, dim(expr)[2])
  tf_r <- tf[which(tf %in% colnames(expr)[seq(start, end, 1)])]
  R <- tigress(expr[,c(seq(start, end, 1))], tflist = tf_r, nstepsLARS=2, nsplit=7, allsteps=FALSE)
  write.csv(R, paste("R_tigress_", as.character(start), ".csv", sep = ""))  
  start = start + 5000
  print("DONE!")
  print(paste("Computation performed in",round(as.numeric(difftime(Sys.time(), start_time,units = "secs")),1), "seconds"))
}